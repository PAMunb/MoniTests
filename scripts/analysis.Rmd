---
title: "JavaMOP"
author: "Rodrigo Bonif√°cio et al."
date: "1/26/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd(".")
library(sqldf)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r load}
bench02mop <- read.csv("mop-report.csv", head=T, sep=",")
bench02cc  <- read.csv("cc-report-converted.csv", head=T, sep=",")
gt <- read.csv("bench02-gt-converted.csv", head=T, sep=",")

gt <- na.omit(gt)
nrow(bench02mop)
colnames(bench02mop)

nrow(bench02cc)
colnames(bench02cc)

colnames(gt)
nrow(gt)
```

```{r descriptive}
sqldf("select distinct spec from bench02mop order by 1")
sqldf("select distinct spec from bench02cc order by 1")

sqldf("select spec, count(*) from bench02mop group by spec")
sqldf("select spec, count(*) from bench02cc group by spec")

sqldf("select error, count(*) from bench02mop group by error")
sqldf("select error, count(*) from bench02cc group by error")
```

## Message Digest

```{r}
md = sqldf("select class, method 
            from bench02cc 
            where spec = 'MessageDigestSpec'")
            
sqldf("select b1.class, b1.method 
       from bench02mop b1 
       where b1.spec = 'MessageDigestSpec' and 
             (b1.class, b1.method) not in (select b2.class, b2.method from md b2)")
```

## Cipher

```{r}
md = sqldf("select class, method 
            from bench02mop
            where spec = 'CipherSpec'")
            
sqldf("select b1.class, b1.method 
       from bench02cc b1 
       where b1.spec = 'CipherSpec' and 
             (b1.class, b1.method) not in (select b2.class, b2.method from md b2)")
```

## IVParameterSpec

```{r}
md = sqldf("select class, method 
            from bench02mop
            where spec = 'IvParameterSpecSpec'")
            
sqldf("select b1.class, b1.method 
       from bench02cc b1 
       where b1.spec = 'IvParameterSpecSpec' and 
             (b1.class, b1.method) not in (select b2.class, b2.method from md b2)
       order by 1" )
```


## SecureRandomSpec

```{r}
md = sqldf("select class, method 
            from bench02mop
            where spec = 'SecureRandomSpec'")
            
sqldf("select b1.class, b1.method 
       from bench02cc b1 
       where b1.spec = 'SecureRandomSpec' and 
             (b1.class, b1.method) not in (select b2.class, b2.method from md b2)
       order by 1" )
```


## Ground Truth (MOP)

```{r}
gt <- sqldf("select propertyShortName, class, method, vulnerability 
            from gt")

nrow(gt)

tp <- gt[gt$vulnerability == "TRUE",]
tn <- gt[gt$vulnerability == "FALSE",]

sqldf("select count(distinct class) from tp")
sqldf("select count(distinct class) from tn")

# true positive 
sqldf("select count(distinct className) 
       from bench02mop 
       where className in (select class from tp)")

# false positive 
sqldf("select count(distinct className) 
       from bench02mop 
       where className in (select class from tn)")



# false-negative  
sqldf("select count(distinct class)
       from tp 
       where class not in (select className from bench02mop)")

precision_mop <- 79 / (79 + 14)
precision_mop

recall_mop <- 79 / (79 + 58)
recall_mop
```


## Ground Truth (CC)

```{r}
# true positive 
sqldf("select count(distinct className) 
       from bench02cc
       where className in (select class from tp)")

# false positive 
sqldf("select count(distinct className) 
       from bench02cc
       where className in (select class from tn)")

# false-negative  
sqldf("select count(distinct class)
       from tp 
       where class not in (select className from bench02cc)")

precision_mop <- 99 / (99 + 27)
precision_mop

recall_mop <- 99 / (99 + 38)
recall_mop
```

## Examples of FP and FN 

```{r}
# false positive 
sqldf("select distinct className
       from bench02mop 
       where className in (select class from tn)")



# false-negative  
sqldf("select distinct class
       from tp 
       where class not in (select className from bench02mop)")
```